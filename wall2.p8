pico-8 cartridge // http://www.pico-8.com
version 18
__lua__


function _init()

 we = {}
 mo = {}
 fc = {}

 we.x = 20
 we.y = 10
 we.flip = false
 we.player = true
 we.direction = {false,false,true,false}
 we.go_time = 4
 
 mo.x = 90
 mo.y = 10
 mo.sprite = 7
 mo.flip = false
 mo.player = true
 mo.clean_time = 0
 
 fc_added = 0
 fc_cleaned = 0
 playing = false
end 

function _update()
 if (not playing) then
  listen_start()
  return
 end
 
 move_guy(we, 0)
 move_guy(mo, 1) 
 
 add_fc()
 clean_fc()
end

function _draw()
 cls()
 
 if not playing then
  draw_start()
  return
 end

 for c in all(fc) do
  spr(c.sprite, c.x*8, c.y*8) 
 end

 spr(9, we.x, we.y, 2, 2, we.flip)
 spr(mo.sprite, mo.x, mo.y, 2, 2, mo.flip)

 print(fc_added - fc_cleaned, 0, 0)
end



-->8
-- foreign contaminant

function add_fc()
 tx = flr(we.x / 8) + 1
 ty = flr(we.y / 8) + 2
 
 if (get_fc(tx, ty) == nil) then
	 c = {}
	 c.x = tx
	 c.y = ty
	 --choice = {5,6,21,22,37}
	 --c.sprite = choice[flr(rnd(5))+1]
  c.sprite = 37
  add(fc,c)
  fc_added += 1
 end
end

function clean_fc()
 mo.clean_time -= 1
 if (mo.clean_time < 0) then
  mo.sprite = 7
 end
 tx = flr(mo.x / 8) + 1
 ty = flr(mo.y / 8) + 2

 c = get_fc(tx, ty)
 if (c != nil) then
  
  del(fc, c)
  -- mo.sprite = 11
  mo.clean_time = 3
  fc_cleaned += 1
 end
end

function get_fc(x,y)
 for c in all(fc) do
  if (c.x == x and c.y == y) then
   return c
  end
 end
 
 return nil
end
-->8
-- wall-e and mo common

function move_guy(guy, p)

 
 if (not guy.player) then
  if (guy == mo) computer_mo()
  if (guy == we) computer_we()
  return
 end
 
 if (btn(0,p)) then
 	guy.x-=1
 	guy.flip = true
 end
 if (btn(1,p)) then
  guy.x+=1
  guy.flip = false
 end
 if (btn(2,p)) guy.y-=1
 if (btn(3,p)) guy.y+=1

 keep_onscreen(guy)
end

function keep_onscreen(guy)
 stopped = false
 
 if (guy.x < 0) then
  stopped = true
  guy.x = 0
 end
 if (guy.x > 128-16) then
  stopped = true
  guy.x = 128-16
 end
 if (guy.y < 0) then
  stopped = true
  guy.y = 0
 end
 if (guy.y > 128-16) then
  stopped = true
  guy.y = 128-16
 end
 
 return stopped
end


function computer_mo()
 closest = nil
 least = 1000
 for c in all(fc) do
  dist = abs(mo.x + 8 - c.x*8) + abs(mo.y + 16 - c.y*8) 
  if (dist < least) then
   closest = c
   least = dist
  end
  
 end
 
 if (closest != nil) then
  x = (closest.x - 1) * 8
  y = (closest.y - 2) * 8
  if (x < mo.x) then
   mo.x -=1
   mo.flip = true
  end
  if (x > mo.x) then
   mo.x +=1
   mo.flip = false
  end
  if (y < mo.y) mo.y -=1
  if (y > mo.y) mo.y +=1
 end
 
end

function computer_we()
 if (we.direction[1]) then
  we.x-=1
 	we.flip = true
 end
 if (we.direction[2]) then
  we.x+=1
 	we.flip = false
 end
 if (we.direction[3]) we.y-=1 
 if (we.direction[4]) we.y+=1
 
 we.go_time -= 1
 if (keep_onscreen(we) or we.go_time <= 0) then
  change_direction_we()
 end
 
end

function change_direction_we()
 we.direction = {false,false,false,false}
 d = flr(rnd(8)+1)
 if (d < 5) we.direction[d] = true
 if (d == 5) we.direction = {true,false,true,false}
 if (d == 6) we.direction = {true,false,false,true}
 if (d == 7) we.direction = {false,true,true,false}
 if (d == 8) we.direction = {false,true,false,true}
 
 we.go_time = flr(rnd(50) + 20)
end


-->8
-- start screen

option=0
function draw_start()

 h=6
 rectfill(19, 39 + option * h, 120, 45 + option * h, 10) 

 print("", 20, 40, 5)
 print("wall-e vs. mo")
 print("wall-e vs. computer")
 print("mo vs. computer")
 print("computer vs. computer")
 
 spr(9, 20, 10, 2, 2, false)
 spr(7, 90, 10, 2, 2, true)


end

function listen_start()
 if (btnp(2)) option = (option+3)%4
 if (btnp(3)) option = (option+1)%4
 if (btnp(4) or btnp(5)) then
  if (option == 1) mo.player = false
  if (option == 2) we.player = false
  if (option == 3) then
   mo.player = false
   we.player = false
  end
  playing=true
	end
end
__gfx__
00000000000000000050500000055500005550000400050000450040000000000000000000444499444990000000000000000000000000000000000000000000
00000000000000000505050000050000000050005004004005004005000000888000000000484955949559000000008880000000000000000000000000000000
00700700000000000555550000050000000050000040505000045404000777777770000000048955949559000007777777700000000000000000000000000000
00077000044545400005000000454454454454000500040005405050007757777777000000004499444990000077577777770000000000000000000000000000
00077000040555400999990000449444944444004005050004004004007775777777000000000008400000000077757777770000000000000000000000000000
00700700044545400999990000444554455445000540400000540400007777777777700000000000840000000077777777777000000000000000000000000000
00000000000000000040400000544554455444000400040000400050000770000000700000009999999999000007700000007000000000000000000000000000
00000000000000000040400000449555555494004005405004005004000070aa0aa070000009944444449060000070aa0aa07000000000000000000000000000
00040000000000000000000000444555555454000040500000040400000070000000700000994488800000000000700000007000000000000000000000000000
00404000000000000000000000444554455444005450040000400050000007777777000000944888800090600000077777770000000000000000000000000000
04000400000000000000000000494554455444005004004004505004000770777777000000944444444490600007707777770000000000000000000000000000
40000040000000000000000000444444944449000040500000040400000777111111100000945044444499000007775757577000000000000000000000000000
000000000000000000000000004454444444540004000400005000500000751cccccc10000956504444999000000775111111100000000000000000000000000
000000000000000000000000000000000000000045050050040040050007500111111100000656509999990000075501cccccc10000000000000000000000000
00000000000000000000000000000000000000000040400000540504000077777770000000696965050600000000777011111110000000000000000000000000
00000000000000000000000000000000000000000450040000400040000000555000000006555556505560000000000555000000000000000000000000000000
00000000000000000000000000000000000000000400040000040000004000400000007777000000ccc33c333333b33300000000000000000000000000000000
00009a9a9a9a00000000a9a9a9a9000000000000400400400040400004040404000007000070000033333333ccc333cc00000000000000000000000000000000
0000a9a9a9a9000000009a9a9a9a000000000000004040000400040000000000000070c00c070000cc333cc3333ccccc00000077700000000000000000000000
00000005500000000000000550000000000000000400040040000040000000000000700000070000333b33333b333ccc00000777770000000000000000000000
077777755777777007777775577777700000000040040040000400000040004000000777777000003bccccccccccc33300007000007000000000077777700000
07777777777d777007777777777d7770000000000040400000404000040404040000000000000000cc3333cccccccccc070770c0c07707000000770000770000
00077777777770000007777777777000000000000400040004000400000000000070777777770700cccccc33cccc33b307077000007707000007700000077000
00078888888870000007888888887000000000004004004040000040000000000070777777770770333333333b33c33307077777777707000007700000077000
00078888888870000007888888887000000000000000000000000000000000000770777777770770cccccccc33333333070777777b7707000007777777777000
00578888888875000057888888887500000000000000000000000000000000000770777777770770ccccc3333bb333cc07077777777700000007777777bb7000
0057888888887500005788888888750000000000000000000000000000000000007077777777077033b333333333333300007777777000000007777777bb7000
00577777777775000057777777777500000000000000000777000000000000000070777777770700cc33333b333c33b300000777770000000007777777777000
00555555555555000055555555555500000000000000007777700000000000000000777777770700bb3333333333cccc00000077700000000000777777770000
0055555555555500005555555555550000000000000007000007000000000000000007777770000033cccccccccccccc00000000000000000000077777700000
00555555555555000055555555555500000000000070770c0c0770700000000000000077770000003333b333cccccc3300000000000000000000007777000000
00555555555555000055555555555500000000000070770000077070000000000000000000000000cccccccc3cccb3cc00000000000000000000000000000000
0000000000000000cccccccccccccccc000000000070777777777070000000000000000070070000000000000000000000000000000000000000000000000000
0000000000000000cccccccccccccccc000000000070777777377070000000000000000007700000000000000000000000000000000000000000000000000000
0000000000000000ccccccccccc777cc0000000000707777777770500000000f0000000007700000000000000000000000000000000000000000000000000000
0000000000000000ccccccccccc707cc00000000000007777777000000000000f000000070070000000000000000000000000000000000000000000000000000
0000077777700000cccccccccc77777e000000000000007777700000000000ff0f00000000000000000000000000000000000000000000000000000000000000
0000770000770000ccccccccc777777e00000000000000077700000000000000f040000000000000000000000000000000000000000000000000000000000000
0007700000077000ccc77777770777cc000000000000000000000000000000000444000000000000000000000000000000000000000000000000000000000000
0007700000077000c770770007007ccc000000000000000000000000000000000404000000000000000000000000000000000000000000000000000000000000
00077777777770007707707077777ccc000000000000000000000000000000004444000000000000000000000000000000000000000000000000000000000000
0007777777337000c70700077777cccc000000000000000000000000000000444440000000000000000000000000000000000000000000000000000000000000
0007777777337000cc7777070077cccc000000000000000000000000000004444444000000000000000000000000000000000000000000000000000000000000
0007777777777000b3b77777707bbb3b000000000000000000000000004444444404000000000000000000000000000000000000000000000000000000000000
0000777777770000bbb77ffff773bbbb000000000000000000000000000444444004000000000000000000000000000000000000000000000000000000000000
00000777777000003bb77bff377bbb3b000000000000000000000000000004000404000000000000000000000000000000000000000000000000000000000000
0000007777000000bb377bbbb77b3bbb000000000000000000000000000004000400400000000000000000000000000000000000000000000000000000000000
0000000000000000bbbffb3bbffbbbb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a3a2a2a3a3a3a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a3a2a2a2a2a3a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a3a2a47484243090a2a2a2a2a2a3b3b2a2a3a2a2a3a2a2a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2a2a575852532a2a2a2a2a2a2a2a2a2a2a3a2a3a2a2a2a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3a3a2a070c0b0c090a2c2d3536282a2e2f2a41202122233a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3a3b3b17181b1c191a3c3d454638393e3f5051303132332a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a3b3b07080b0c090a2c2d353628292e2f4041202122233a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2a2a17181b1c191a3c3d454638393e3f5051303132332a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2a2a2a2a2a2a2a2a2a2b3b3b2b3a3a2a3a3a2a2a2a2a2a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001120113750057500a7500d75015750187501a750197501775017750117500d750097500475003740007300172001710005002c500305002a500255002b5002d5002d5003c5000000000000000000c50000000
