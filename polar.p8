pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
target = {
 x=50,
 y=50,
 vx=0,
 vy=0,
 v=1.5
}

function _init()
 for i=1,1000 do
		new_missle()
 end
end

function _update()
	move_player()
 
 for m in all(missles) do
  chase(m,target)
  
  e = unpolar(m.x,m.y,m.angle,m.v)
  m.x = e.x;
  m.y = e.y;
 end
end

function _draw()
 cls()
 for m in all(missles) do
  e = unpolar(m.x,m.y,m.angle,-3)
  line(m.x,m.y,e.x,e.y,6)
  pset(m.x,m.y,13)
  pset(e.x,e.y,8)
 end
 pset(target.x,target.y,11)
end

-->8
-- missles
missles = {}

function new_missle()
 v=0.8 + rnd()*0.4
 vr = 0.005 + rnd() * 0.02
 angle = rnd()
 x = 128 * rnd()
 y = 128 * rnd()
 
 m = {
  x=x,y=y,angle=angle,v=v,vr=vr
 }
 add(missles,m)
end

function chase(m,t)
 a = polar(m.x,m.y,t.x,t.y)
 -- m.angle = a.angle
 --print (m.angle.." "..a.angle.." "..abs(m.angle-a.angle))
 --if m.angle < a.angle then
 if m.angle < a.angle and abs(m.angle-a.angle) < 0.5  then
  m.angle = (m.angle + m.vr) % 1
 else
  m.angle = (m.angle - m.vr) % 1
 end
end
-->8
-- helpers

function unpolar(x,y,angle,d)
 return {x=x-d*sin(angle)
 	,y=y-d*cos(angle)}
end

function polar(x,y,gx,gy)
 angle=atan2((y-gy),(x-gx))
 d = sqrt((x-gx)^2 + (y-gy)^2)
 return {d=d
 	, angle=angle}
end

-->8
-- player

function move_player()
	target.vx = 0
	target.vy = 0
 if (btn(0)) target.vx = -target.v
 if (btn(1)) target.vx = target.v
 if (btn(2)) target.vy = -target.v
 if (btn(3)) target.vy = target.v
 
 target.x += target.vx
 target.y += target.vy

 if (target.x < 0) target.x = 0
 if (target.y < 0) target.y = 0
 if (target.x > 127) target.x = 127
 if (target.y > 127) target.y = 127
end
__gfx__
00000000cccccccc6665666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cc7ccccc6665666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700c777cccc6665566600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000cccccc7c6655556600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ccccc7776555555600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700cc7ccccc6555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c777cccc5555555600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc6a6a6a6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101020101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010102010101010101020101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010201010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
